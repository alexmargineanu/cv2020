{"version":3,"sources":["App/ICal/index.jsx","App/Table/index.jsx","App/Map/utils.jsx","App/Map/RenderPipeline.jsx","App/Map/D3Map.jsx","App/Map/DataPipeline.jsx","App/Map/index.jsx","App/index.jsx","serviceWorker.js","index.js"],"names":["iCalParser","data","calendarEntries","ICAL","length","map","event","e","i","prop","flattenEvent","console","error","name","message","Table","state","totalTime","totalDistance","prevProps","prevState","this","props","flight","setState","parseFloat","duration","toFixed","distance","from","className","icon","faCalendarAlt","format","dtstart","faPlaneDeparture","faClock","dtend","style","textAlign","to","faPlaneArrival","React","Component","cssClass","c","replace","split","join","projection","d3","translate","window","innerWidth","innerHeight","scale","path","RenderPipeline","args","cities","flights","updateFlight","getCurrentFlight","flightTime","svg","circles","selectAll","enter","append","attr","d","longitude","latitude","exit","remove","forEach","flightCoords","type","coordinates","uid","each","index","setTimeout","animateFlightPath","arrow","fromCity","toCity","flightPath","dashedPath","node","totalLength","getTotalLength","t","delay","on","transition","attrTween","text","checkLabelOverlapping","thisBBox","getBBox","filter","k","j","underBBox","l","r","left","x","right","width","top","y","bottom","height","a","b","getOverlapFromTwoExtents","D3Map","world","worldMap","datum","countries","topojson","objects","features","insert","zoom","scaleExtent","select","transform","call","citiesPipeline","moment","diff","withAirportCode","location","pop","summary","trim","city","find","occurence","reduce","findIndex","fromCoords","toCoords","sort","Map","mapRef","createRef","fetch","then","response","json","catch","current","Promise","all","geoDb","DataPipeline","addCityNames","filterCities","valCities","addGeoData","valFlights","f","renderFlightPath","renderCircles","renderLabels","err","log","ref","App","url","status","txt","parsedEvents","flightEvents","indexOf","addFlightDuration","CSSTransition","timeout","classNames","in","appear","updateCurrentFlight","Boolean","hostname","match","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.12018954.chunk.js","sourcesContent":["import * as ICAL from 'ical.js';\n\nconst iCalParser = (data) => {\n\n    const dumpCalendar = (parsedEvents) => {\n        const comp = new ICAL.Component(['vcalendar', [], []]);\n\n        const flightEvents = parsedEvents.filter(d => {\n            if(d.summary){\n                return d.summary.indexOf('Flight to') > -1;\n            }\n            return false;\n        });\n        flightEvents.map(f => {\n            const vevent = new ICAL.Component('vevent');\n            var event = new ICAL.Event(vevent);\n            event.summary = f.summary;\n            event.location = f.location;\n            event.uid = f.uid;\n\n            vevent.addPropertyWithValue('dtstart', f.dtstart);\n            vevent.addPropertyWithValue('dtend', f.dtend);\n            vevent.addPropertyWithValue('dtstamp', f.dtstamp);\n            vevent.addPropertyWithValue('created', f.created);\n\n            comp.addSubcomponent(vevent);\n        });\n\n        console.log(comp.toString());\n\n\n    }\n\n    const flattenEvent = (e) => {\n        let event = {};\n        for(let i = 0; i < e[1].length; i++) {\n            let prop = e[1][i];\n            event[prop[0]] = prop[3];\n        }\n        return event;\n    };\n\n    try {\n        const calendarEntries = ICAL.parse(data);\n        if(calendarEntries.length && calendarEntries[2]){\n            const events = calendarEntries[2];\n            const e = events.map(event => flattenEvent(event));\n            //dumpCalendar(e);\n            return e;\n        } else {\n            console.error('no parsed events');\n            return [];\n        }\n    }\n    catch(error) {\n        console.error(error.name, error.message);\n    }\n\n};\n\nexport default iCalParser;\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nimport Moment from 'react-moment';\n\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport {\n    faPlaneDeparture,\n    faPlaneArrival,\n    faCalendarAlt,\n    faClock,\n} from '@fortawesome/free-solid-svg-icons';\n\nimport './index.scss';\n\nclass Table extends React.Component {\n\n    constructor() {\n        super();\n        this.state = {\n            totalTime: 0,\n            totalDistance: 0,\n        };\n    }\n\n    componentDidUpdate(prevProps, prevState) {\n        if(this.props.flight && prevProps.flight !== this.props.flight) {\n            this.setState({\n                totalTime: (parseFloat(prevState.totalTime) + parseFloat(this.props.flight.duration)).toFixed(1),\n                totalDistance: (parseFloat(prevState.totalDistance) + parseFloat(this.props.flight.distance)).toFixed(0),\n            });\n        }\n    }\n\n    render() {\n        const {\n            flight,\n        } = this.props;\n\n        const {\n            totalTime,\n            totalDistance,\n        } = this.state;\n\n        if(!flight.from) {\n            return (\n                <section className=\"Table\">\n                    <h1>\n                        <small className=\"separator\">loading flights</small>\n                    </h1>\n                </section>\n            );\n        }\n\n        return (\n            <section className=\"Table\">\n                <h1>\n                    <FontAwesomeIcon icon={faCalendarAlt} /> <Moment format='DD MMM YYYY'>{flight.dtstart}</Moment>\n                </h1>\n                <ul>\n                    <li>\n                        <h2>\n                            <FontAwesomeIcon icon={faPlaneDeparture} /> {flight.from}\n                        </h2>\n                    </li>\n                    <li className=\"separator\">\n                        <Moment format='hh:mma'>{flight.dtstart}</Moment>\n                        <small>\n                            <FontAwesomeIcon icon={faClock} /> {flight.duration} h\n                        </small>\n                        <Moment format='hh:mma'>{flight.dtend}</Moment>\n                    </li>\n                    <li>\n                        <h2 style={{textAlign: 'right'}}>\n                            {flight.to} <FontAwesomeIcon icon={faPlaneArrival} />\n                        </h2>\n                    </li>\n                </ul>\n                <small className=\"info\">\n                    Total flight time: <strong>{totalTime} h</strong>, distance: <strong>{totalDistance} km</strong> (aprox)\n                </small>\n            </section>\n        );\n    }\n}\n\nTable.propTypes = {\n    flight: PropTypes.object,\n};\n\nexport default Table;\n","const getOverlapFromTwoExtents = (l, r) => {\n    var overlapPadding = 0;\n    l.left = l.x - overlapPadding;\n    l.right = l.x + l.width + overlapPadding;\n    l.top = l.y - overlapPadding;\n    l.bottom = l.y + l.height + overlapPadding;\n    r.left = r.x - overlapPadding;\n    r.right = r.x + r.width + overlapPadding;\n    r.top = r.y - overlapPadding;\n    r.bottom = r.y + r.height + overlapPadding;\n    var a = l;\n    var b = r;\n\n    if (a.left >= b.right || a.top >= b.bottom ||\n    a.right <= b.left || a.bottom <= b.top ){\n        return false;\n    } else {\n        return true;\n    }\n};\n\nconst cssClass = (c) => c\n    .replace('@', '')\n    .replace('.', '')\n    .replace('#', '')\n    .split(' ')\n    .join('');\n\nexport { getOverlapFromTwoExtents, cssClass };\n","import * as d3 from 'd3';\n\nimport {\n    getOverlapFromTwoExtents,\n    cssClass\n} from './utils';\n\nconst projection = d3.geoMercator().translate(\n    [window.innerWidth / 2, window.innerHeight / 2]\n).scale(\n    190\n);\n\nconst path = d3.geoPath().projection(projection);\n\nexport { path, projection };\n\nclass RenderPipeline  {\n\n    constructor(args) {\n        this.cities = args.cities;\n        this.flights = args.flights;\n        this.updateFlight = args.getCurrentFlight;\n        this.flightTime = args.flightTime || 2500;\n        this.svg = args.svg;\n    }\n\n    renderCircles() {\n        const circles = this.svg.selectAll('circle').data(this.cities);\n        circles.enter().append('svg:circle')\n            .attr('cx', d => projection([d.longitude,d.latitude])[0])\n            .attr('cy', d => projection([d.longitude,d.latitude])[1])\n            .attr('r',  4.5)\n            .attr('class', d => `city${cssClass(d.name)}`);\n        circles.exit().remove();\n\n        return this;\n    }\n\n    renderFlightPath() {\n        this.flights.forEach(flight => {\n            if(flight.flightCoords && flight.flightCoords.length === 2) {\n                this.svg.append('path')\n                    .attr('d', path({\n                        type: 'LineString',\n                        coordinates: [\n                            flight.flightCoords[0],\n                            flight.flightCoords[1]\n                        ]\n                    }))\n                    .attr('class', `flight-path flight-path${cssClass(flight.uid)}`);\n\n\n                    this.svg.append('path')\n                        .attr('d', path({\n                            type: 'LineString',\n                            coordinates: [\n                                flight.flightCoords[0],\n                                flight.flightCoords[1]\n                            ]\n                        }))\n                        .attr('class', `dashed dashed${cssClass(flight.uid)}`);\n            } else {\n                console.error('no flightCoords for', flight);\n            }\n        });\n\n        this.svg.append('path')\n            .attr('d', 'M-5,0 L-5,5 L5,0 L-5,-5 Z')\n            .attr('class', 'arrow');\n\n        this.svg.selectAll('.flight-path').data(this.flights).each(\n            (flight, index) => {\n                if(flight.to && flight.from) {\n                    setTimeout(\n                        () => {\n                            this.updateFlight(flight);\n                            this.animateFlightPath(flight);\n                        }, this.flightTime * index\n                    )\n                }\n            }\n        );\n        return this;\n    }\n\n    animateFlightPath(d) {\n        const arrow           = d3.select('.arrow');\n        const fromCity        = d3.select(`.city${cssClass(d.from)}`);\n        const toCity          = d3.select(`.city${cssClass(d.to)}`);\n        const flightPath      = d3.select(`.flight-path${cssClass(d.uid)}`);\n        const dashedPath      = d3.select(`.dashed${cssClass(d.uid)}`);\n\n        const path = flightPath.node();\n        const totalLength = path ? path.getTotalLength() : null;\n\n        const pointAtLength = (l) => {\n            const xy = path.getPointAtLength(l);\n            return [xy.x, xy.y];\n        };\n\n        // Approximate tangent\n        const angleAtLength = (l) => {\n            const a = pointAtLength(Math.max(l - 0.01,0)); // this could be slightly negative\n            const b = pointAtLength(l + 0.01); // browsers cap at total length\n            return Math.atan2(b[1] - a[1], b[0] - a[0]) * 180 / Math.PI;\n        };\n\n        const t = d3.transition()\n            .duration(this.flightTime - 300)\n            .delay(0)\n            .on('start',function(){\n                const setVisible = [\n                    arrow,\n                    flightPath,\n                    fromCity,\n                    toCity,\n                    dashedPath,\n                ];\n                setVisible.forEach(path => path.style('display', 'block'));\n                toCity.attr('r', parseFloat(toCity.attr('r'))+0.25);\n            })\n            .on('end',function(){\n                dashedPath.style('stroke', '#999');\n                flightPath.style('display', 'none');\n                arrow.style('display', 'none');\n            });\n\n        if(totalLength){\n            /*todo: \n            arrow.transition(t)\n                .attrTween('transform',function(){\n                    return function(t){\n                        const pos = t * totalLength;\n                        return 'translate(' + pointAtLength(pos) + ') rotate( ' + angleAtLength(pos) + ')';\n                    };\n                });\n            */\n            flightPath.transition(t)\n                .attrTween('stroke-dasharray',function(){\n                    return d3.interpolateString('0,' + totalLength,totalLength + ',' + totalLength);\n                });\n        }\n    }\n\n    renderLabels() {\n        this.svg.append('g').selectAll('g')\n            .data(this.cities)\n            .enter().append('g')\n            .append('text')\n            .attr('x', d => projection([d.longitude,d.latitude])[0] + 8)\n            .attr('y', d => projection([d.longitude,d.latitude])[1] + 3)\n            .attr('class', d => `label${cssClass(d.name)}`)\n            .text(d => d.name);\n\n        this.checkLabelOverlapping(this.svg.selectAll('text'));\n\n        return this;\n    }\n\n    checkLabelOverlapping(data){\n        data.each(function(d, i) {\n            const thisBBox = this.getBBox();\n            data.filter((k, j) => j > i).each(function(){\n                const underBBox = this.getBBox();\n                if(getOverlapFromTwoExtents(thisBBox, underBBox)){\n                    d3.select(this).style('opacity', 0.5);\n                }\n            });\n        });\n\n        return this;\n    }\n\n}\n\nexport default RenderPipeline;\n","import * as d3 from 'd3';\nimport * as topojson from 'topojson';\nimport { path } from './RenderPipeline';\n\nclass D3Map {\n\n    constructor(args) {\n        this.world = args.world;\n        this.svg = args.svg;\n\n        this.worldMap();\n    }\n\n    worldMap(){\n        this.svg.append('path')\n            .attr('d', path)\n            .datum(d3.geoGraticule())\n            .attr('class', 'grid');\n\n        const countries = topojson.feature(this.world, this.world.objects.countries).features;\n        this.svg.selectAll('.country')\n            .data(countries)\n            .enter().insert('path', '.grid')\n            .attr('class', 'country')\n            .attr('d', path)\n            .style('fill', '#fff');\n\n\n        const zoomed = () => {\n            this.svg.select('.arrow').attr('transform', d3.event.transform);\n            this.svg.selectAll('path').attr('transform', d3.event.transform);\n            this.svg.selectAll('circle').attr('transform', d3.event.transform);\n            this.svg.selectAll('text').attr('transform', d3.event.transform);\n        };\n\n        const zoom = d3.zoom().scaleExtent([1, 3]).on('zoom', zoomed);\n\n        this.svg.call(zoom);\n    }\n}\n\nexport default D3Map;\n","import moment from 'moment';\n\nclass citiesPipeline {\n    constructor(args) {\n        this.cities = args.cities;\n        this.flights = args.flights;\n    }\n\n    get valCities() {\n        return this.cities;\n    }\n\n    get valFlights() {\n        this.flights.sort(function(a, b) {\n          if (a.dtstart < b.dtstart) {\n            return -1;\n          }\n          if (a.dtstart > b.dtstart) {\n            return 1;\n          }\n          return 0;\n        });\n        return this.flights;\n    }\n\n    addFlightDuration() {\n        this.flights = this.flights.map(e => {\n            const duration = parseFloat(moment(e.dtend).diff(moment(e.dtstart), 'hours', true)).toFixed(1);\n            const distance = duration * 750/*km/h*/;\n            return {\n                ...e,\n                duration,\n                distance,\n            };\n        });\n\n        return this;\n    }\n\n\n    addCityNames() {\n        this.flights = this.flights.map(e => {\n\n            // get London from \"London LHR\"\n            const withAirportCode = e.location.split(' ');\n            withAirportCode.pop();\n            let from = withAirportCode.join(' ');\n\n            // get BCN from \"Flight to BCN (FR 3064)\"\n            let to = e.summary.replace('Flight to ', '').replace(/\\([^()]*\\)/g, '').trim();\n\n            return {\n                ...e,\n                from,\n                to,\n            };\n        });\n\n        return this;\n    }\n\n    filterCities(){\n        this.cities = this.cities.filter(city => this.flights.find(\n            flight => flight.to === city.name || flight.from === city.name\n        ));\n\n        return this;\n    }\n\n    countCityOccurrence() {\n        this.cities = this.cities.map(\n            city => {\n                const occurence = this.flights.reduce(\n                    (occurence, flight) => {\n                        if(flight.to === city.name || flight.from === city.name){\n                            occurence++;\n                        }\n                        return occurence;\n                    }, 0\n                );\n                return { ... city, occurence };\n            }\n        );\n\n        return this;\n    }\n\n    addGeoData() {\n        this.flights = this.flights.map(flight => {\n            const to = this.cities.findIndex(city => city.name === flight.to);\n            const from = this.cities.findIndex(city => city.name === flight.from);\n            const fromCoords = {\n                fromCoords: from === -1 ? [] : [this.cities[from].longitude, this.cities[from].latitude]\n            };\n            const toCoords = {\n                toCoords: to === -1 ? [] : [this.cities[to].longitude, this.cities[to].latitude]\n            };\n            const flightCoords = {\n                flightCoords: to > -1 && from > -1 ? [\n                    [this.cities[from].longitude, this.cities[from].latitude],\n                    [this.cities[to].longitude, this.cities[to].latitude]\n                ] : []\n            };\n            const obj = {\n                ...flight,\n                ...flightCoords,\n                ...fromCoords,\n                ...toCoords,\n            };\n            return obj;\n        });\n\n        return this;\n    }\n}\n\nexport default citiesPipeline;\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nimport * as d3 from 'd3';\n\nimport D3Map from './D3Map';\nimport DataPipeline from './DataPipeline';\nimport RenderPipeline from './RenderPipeline';\n\nimport './index.scss';\n\nclass Map extends React.Component {\n\n    constructor(){\n        super();\n        this.mapRef = React.createRef();\n        this.state = {\n            world: [],\n        };\n    }\n\n    componentDidMount() {\n        const url = 'https://alexmargineanu.github.io/cv2020/world-50m.json';\n        fetch(url)\n            .then(response => response.json()\n                .then(world => this.setState({ world }))\n            )\n            .catch(error => console.error(error));\n    }\n\n    componentDidUpdate(prevProps, prevState) {\n        const { world } = this.state;\n        const svg = d3.select(this.mapRef.current);\n\n        if(prevState.world !== world && world !== null){\n            Promise.all([\n                d3.csv('https://alexmargineanu.github.io/cv2020/geonames_cities100000.csv'),\n            ]).then(([geoDb]) => {\n\n                const data = new DataPipeline({\n                    cities: geoDb,\n                    flights: this.props.flights\n                }).addCityNames();\n\n                new D3Map({ svg, world });\n\n                setTimeout(()=>{\n                    new RenderPipeline({\n                        svg: svg,\n                        cities: data.filterCities().valCities,\n                        flights: data.addGeoData().valFlights,\n                        getCurrentFlight: (f) => this.props.getCurrentFlight(f),\n                        flightTime: 2300,\n                    }).renderFlightPath().renderCircles().renderLabels();\n                }, 2000);\n            }).catch(err => console.log('Error loading or parsing data.', err));\n        }\n    }\n\n    render(){\n        const { world } = this.state;\n\n        if (!world) {\n            return <small>Error</small>;\n        }\n\n        if (world.length && world.length === 0) {\n            return <small>Loading</small>;\n        }\n\n        return (\n            <section className=\"map\">\n                <svg ref={this.mapRef} />\n            </section>\n        );\n    }\n}\n\nMap.propTypes = {\n    flights: PropTypes.array,\n    getCurrentFlight: PropTypes.func,\n};\n\nexport default Map;\n","import React from 'react';\nimport { CSSTransition } from 'react-transition-group';\nimport iCalParser from './ICal';\nimport Table from './Table';\nimport Map from './Map';\nimport DataPipeline from './Map/DataPipeline';\n\nimport './index.scss';\n\nclass App extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            flights: [],\n            flight: {},\n        };\n    }\n\n    updateCurrentFlight(flight){\n        this.setState({ flight });\n    }\n\n    componentDidMount(){\n        const url = 'https://alexmargineanu.github.io/cv2020/data.ics';\n        fetch(url)\n            .then(response => {\n                if(response.status === 200) {\n                    response.text()\n                        .then(txt => {\n                            const parsedEvents = iCalParser(txt);\n                            if(parsedEvents){\n                                const flightEvents = parsedEvents.filter(d => {\n                                    if(d.summary){\n                                        return d.summary.indexOf('Flight to') > -1;\n                                    }\n                                    return false;\n                                });\n                                const flights = new DataPipeline({\n                                    flights: flightEvents\n                                }).addCityNames().addFlightDuration().valFlights;\n\n                                this.setState({ flights });\n                            }\n                        });\n                } else {\n                    console.error('status ' + response.status, 'url:', url);\n                }\n            })\n            .catch(error => console.error(error));\n    }\n\n\n    render() {\n        const { flights, flight } = this.state;\n        return (\n            <CSSTransition\n                timeout={0}\n                classNames=\"water\"\n                in={true}\n                appear={true}\n            >\n                <div className=\"water\">\n                    <Map\n                        flights={flights}\n                        getCurrentFlight={f=>this.updateCurrentFlight(f)}\n                    />\n                    <Table\n                        flight={flight}\n                    />\n                </div>\n            </CSSTransition>\n        );\n    }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\nserviceWorker.unregister();\n"],"sourceRoot":""}